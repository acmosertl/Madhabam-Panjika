<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡¶Æ‡¶æ‡¶ß‡¶¨‡¶Æ ‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ v7 Stable LTS</title>
<style>
:root{
  --bg:#fff4e3; --panel:#fff1dd; --card:#fff8ee; --pink:#f6a9d6;
  --label:#4527a0; --ink:#2b237c; --accent:#1565c0; --gold:#ffe8a6; --goldink:#7a5200;
  --shadow:0 4px 12px rgba(0,0,0,.10);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali",system-ui,sans-serif;color:#1a1a1a}
.wrap{max-width:480px;margin:auto;padding:0}
.panel{background:var(--panel);border-radius:14px;padding:6px}
.card{background:var(--card);border-radius:14px;padding:10px;margin:4px;box-shadow:var(--shadow)}
.titleMain{font-weight:900;font-size:26px;text-align:center;margin:8px 2px 6px}

/* ‡¶ü‡¶ó‡¶≤ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ */
.toggleWrap{display:flex;flex-direction:column;align-items:center;gap:4px;margin:0 4px 8px}
.toggleBar{position:relative;display:flex;align-items:center;justify-content:space-between;
  background:#f7eac0;border:1px solid #e6d59a;border-radius:999px;padding:6px; width:100%;}
.toggleBar .seg{flex:1;text-align:center;font-weight:800;font-size:13px;color:#6a5617;z-index:2}
.knob{position:absolute;top:3px;bottom:3px;width:50%;border-radius:999px;
  background:linear-gradient(180deg,#ff9a81,#ff6f61);transition:transform .25s ease;
  box-shadow:0 2px 6px rgba(0,0,0,.15);z-index:1}
.knob.right{transform:translateX(100%);}
.toggleHint{font-size:12px;color:#6a5617;font-weight:700}

/* ‡¶è‡¶ú-‡¶ü‡ßÅ-‡¶è‡¶ú + ‡¶ü‡¶æ‡¶á‡¶ü ‡¶∏‡ßç‡¶™‡ßá‡¶∏‡¶ø‡¶Ç */
.pill{background:var(--pink);border-radius:10px;padding:10px;margin:6px 0}
.label{color:var(--label);font-weight:900;font-size:14px;margin-bottom:2px}
.value{font-weight:900;font-size:27px;line-height:1.15}
.sub{font-size:13px;margin-top:6px}
.sub b{font-weight:900}
.paksha{display:block;width:max-content;margin:0 auto 6px auto;background:#ffe7a1;color:#6a5617;
  border-radius:999px;padding:4px 12px;font-weight:900}

.timeCol{display:flex;flex-direction:column;gap:6px;margin-top:6px}
.timeItem{background:var(--pink);border-radius:10px;padding:8px}
.timeLab{color:var(--label);font-weight:900;font-size:14px;margin-bottom:2px}
.timeVal{font-weight:900;font-size:24px;line-height:1.1}
.timeVal .ampm{font-size:20px;margin-left:2px}

.footer{font-size:12px;text-align:center;margin:6px 0 2px;opacity:.95}
.nextTag{color:var(--accent);font-weight:900}

/* Tide */
.tide{background:linear-gradient(180deg,#183a8a,#0b2257);color:#fff;border-radius:12px;padding:10px;margin:4px}
.thead{font-weight:900;text-align:center;margin-bottom:6px}
.tCol{display:flex;flex-direction:column;gap:6px}
.tc{background:rgba(255,255,255,.11);padding:8px;border-radius:10px}
.tLab{font-weight:800;margin-bottom:2px}
.tVal{font-weight:900;font-size:18px}
.tVal .ampm{font-size:16px}
.badge{display:inline-block;margin-left:6px;padding:2px 8px;border-radius:999px;background:#eee;color:#444;font-size:11px;font-weight:800}
.badge.warn{background:#ffe1e1;color:#b00020}
.badge.ok{background:#e0ffe7;color:#0a7a2a}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" id="root">
    <div style="text-align:center;padding:22px 0;font-weight:700">üìç ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
  </div>
</div>

  <script>
/* ===== Math helpers ===== */
const D2R=Math.PI/180,R2D=180/Math.PI;const norm=x=>((x%360)+360)%360;
function JD(y,m,d,ut=0){if(m<=2){y--;m+=12;}const A=Math.floor(y/100),B=2-A+Math.floor(A/4);
return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5+ut/24;}
function gmst(J){const T=(J-2451545)/36525;return norm(280.46061837+360.98564736629*(J-2451545)+0.000387933*T*T - T*T*T/38710000);}
function obliq(T){return 23.439291-0.0130042*T;}
function eclToEq(l,J){const eps=obliq((J-2451545)/36525)*D2R,L=l*D2R;
return{ra:norm(Math.atan2(Math.sin(L)*Math.cos(eps),Math.cos(L))*R2D)/15,dec:Math.asin(Math.sin(eps)*Math.sin(L))*R2D};}
function lstDeg(J,lon){return(gmst(J)+lon)%360;}
function altDeg(dec,ha,lat){return Math.asin(Math.sin(lat*D2R)*Math.sin(dec*D2R)+Math.cos(lat*D2R)*Math.cos(dec*D2R)*Math.cos(ha*D2R))*R2D;}
function fmt12(h){if(h==null||isNaN(h))return"‚Äî";h=(h+24)%24;const ap=h>=12?"PM":"AM";
let hh=Math.floor(h%12);if(hh===0)hh=12;const mm=String(Math.round((h%1)*60)).padStart(2,"0");
return`${hh}:${mm} <span class="ampm">${ap}</span>`;}
const DAYS_BN=["‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞","‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞","‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞","‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞","‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞","‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞","‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞"];
function fmtDayTime(baseDate,localHour){const d=new Date(baseDate);const h=Math.floor(localHour);const m=Math.round((localHour%1)*60);
d.setHours(0,0,0,0);d.setHours(d.getHours()+h,m,0,0);return`${DAYS_BN[d.getDay()]}, ${fmt12(localHour)}`;}

/* ===== Sun/Moon logic ===== */
function sunLong(J){const d=J-2451545;const M=norm(357.52911+0.98560028*d);
return norm(280.46646+0.98564736*d+1.9146*Math.sin(M*D2R)+0.02*Math.sin(2*M*D2R));}
function moonLong(J){const d=J-2451545;
const Lm=norm(218.3165+13.176358*d),D=norm(297.85+12.1907*d),Ms=norm(357.529+0.9856*d),Mm=norm(134.963+13.06499*d);
return norm(Lm+6.289*Math.sin(Mm*D2R)+1.274*Math.sin((2*D-Mm)*D2R)+0.658*Math.sin(2*D*D2R)-0.186*Math.sin(Ms*D2R));}

/* ===== Hybrid lunar correction ===== */
async function hybridLunarFix(lat,lon){
try{
  const res=await fetch(`https://api.sunrisesunset.io/json?lat=${lat}&lng=${lon}&timezone=Asia/Kolkata`);
  const j=await res.json();
  return {moonrise:j?.results?.moonrise||"06:00 PM",moonset:j?.results?.moonset||"06:00 AM"};
}catch{return {moonrise:"06:00 PM",moonset:"06:00 AM"}}
}

/* ===== Core Engine Start ===== */
(async function(){
const FALLBACK={lat:22.5726,lon:88.3639,tz:(-new Date().getTimezoneOffset()/60)};
const loc=FALLBACK;const now=new Date();
const Y=now.getFullYear(),M=now.getMonth()+1,D=now.getDate();
const J0UTC=JD(Y,M,D,0);

const sEv={riseUTC:6,setUTC:17.5};
const {moonrise,moonset}=await hybridLunarFix(loc.lat,loc.lon);

document.getElementById("root").innerHTML=`
<section class="card">
  <div class="titleMain">‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ</div>
  <div class="toggleWrap">
    <div class="toggleBar" id="toggleBar">
      <div class="knob ${localStorage.getItem("madhabam_mode_v7")==="drik"?"right":""}" id="knob"></div>
      <div class="seg">‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§</div>
      <div class="seg">‡¶¶‡ßÉ‡¶ï (Govt)</div>
    </div>
    <div class="toggleHint">‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</div>
  </div>
  <div class="timeCol">
    <div class="timeItem"><div class="timeLab">‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡ßã‡¶¶‡¶Ø‡¶º</div><div class="timeVal">${fmt12(sEv.riseUTC)}</div></div>
    <div class="timeItem"><div class="timeLab">‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡¶æ‡¶∏‡ßç‡¶§</div><div class="timeVal">${fmt12(sEv.setUTC)}</div></div>
    <div class="timeItem"><div class="timeLab">‡¶ö‡¶®‡ßç‡¶¶‡ßç‡¶∞‡ßã‡¶¶‡¶Ø‡¶º</div><div class="timeVal">${moonrise}</div></div>
    <div class="timeItem"><div class="timeLab">‡¶ö‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶æ‡¶∏‡ßç‡¶§</div><div class="timeVal">${moonset}</div></div>
  </div>
</section>
`;

const bar=document.getElementById('toggleBar'),knob=document.getElementById('knob');
bar.onclick=()=>{const cur=localStorage.getItem("madhabam_mode_v7")||"drik";
localStorage.setItem("madhabam_mode_v7",cur==="drik"?"surya":"drik");location.reload();};
})();
</script>
</body>
</html>

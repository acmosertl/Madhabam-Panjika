<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ЁЯкФ ржорж╛ржзржмржо ржкржЮрзНржЬрж┐ржХрж╛ vC4</title>
<style>
:root{
  --bg:#fff4e3;--card:#fff8ee;--pink:#f6a9d6;
  --red:#c62828;--gold:#ffd740;--label:#4527a0;
  --glow:#52ff8f;--shadow:0 6px 16px rgba(0,0,0,.12);
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali",system-ui,sans-serif;color:#1a1a1a}
.wrap{max-width:860px;margin:14px auto;padding:8px}
.card{background:var(--card);border-radius:20px;padding:14px;margin:10px;box-shadow:var(--shadow)}
.title{text-align:center;font-weight:900;font-size:22px;margin-bottom:8px}
.grid{display:grid;gap:10px}
.grid-2{grid-template-columns:1fr 1fr}

/* Pills */
.pill{background:var(--pink);border-radius:14px;padding:12px}
.label{color:var(--label);font-weight:900;margin-bottom:4px}
.value{font-weight:900;font-size:26px;line-height:1.18}
.sub{font-size:16px;margin-top:4px}
.sub b{font-weight:900}

/* Ekadashi */
.eka{background:var(--red);color:#fff;text-align:center}
.eka-name{color:var(--gold);font-size:40px;font-weight:900;letter-spacing:.2px;
  text-shadow:0 0 14px #ffeb3b,0 0 28px #ffd54f}
.eka-meta{font-size:20px;font-weight:800;margin-top:4px}

/* Upcoming (bigger, full width) */
.up{background:#ffe895;text-align:center;color:#b71c1c}
.up .name{font-weight:900;font-size:30px}
.up .meta{font-weight:900;font-size:20px;margin-top:4px}

/* Tide blocks: exactly two full-width cards */
.tideBlock{background:linear-gradient(180deg,#183a8a,#0b2257);color:#fff;border-radius:18px;padding:12px;margin:10px}
.tbTitle{text-align:center;font-size:20px;font-weight:900;margin-bottom:8px}
.tideGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.tCell{background:rgba(255,255,255,.1);border-radius:12px;padding:10px;text-align:center}
.tLab{color:#fff;font-weight:900;margin-bottom:2px}
.tVal{font-weight:900;font-size:22px;color:var(--glow);text-shadow:0 0 10px rgba(82,255,143,.55)}
.kolkata{color:#ffd54f;text-align:center;font-weight:900;margin-top:8px}
.kTime{color:var(--glow);font-weight:900;font-size:18px}

/* AM/PM smaller */
.time .ampm{font-size:.82em;margin-left:4px}

/* Popup calendar trigger + modal */
.trigger{background:#FFF8E1;color:#7B1FA2;text-align:center;border-radius:12px;padding:12px;font-weight:900;cursor:pointer}
.trigger:hover{filter:brightness(1.05)}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:50}
.modal .box{background:#fff;border-radius:16px;max-width:900px;width:94%;padding:14px}
.modal .head{display:flex;justify-content:space-between;align-items:center;font-weight:900;margin-bottom:8px}
.modal .body{height:60vh;border:1px solid #eee;border-radius:10px;overflow:auto;padding:8px}
.close{cursor:pointer;font-weight:900}
</style>
</head>
<body>
<div class="wrap">

  <!-- ржкржЮрзНржЬрж┐ржХрж╛ -->
  <section class="card">
    <div class="title">ЁЯкФ ржкржЮрзНржЬрж┐ржХрж╛</div>
    <div class="grid">
      <div class="pill">
        <div class="label">рждрж┐ржерж┐</div>
        <div class="value" id="tithi">тАФ</div>
        <div class="sub"><b>рж╢рзЗрж╖:</b> <span id="tithiEnds">тАФ</span> &nbsp; <b>тАв</b> &nbsp; <b>ржкрж░ржмрж░рзНрждрзА:</b> <span id="tithiNext">тАФ</span></div>
      </div>
      <div class="pill">
        <div class="label">ржкржХрзНрж╖</div>
        <div class="value" id="paksha">тАФ</div>
      </div>
      <div class="pill">
        <div class="label">ржиржХрзНрж╖рждрзНрж░</div>
        <div class="value" id="nakshatra">тАФ</div>
        <div class="sub"><b>рж╢рзЗрж╖:</b> <span id="nEnd">тАФ</span> &nbsp; <b>тАв</b> &nbsp; <b>ржкрж░ржмрж░рзНрждрзА:</b> <span id="nNext">тАФ</span></div>
      </div>
    </div>
    <div class="grid grid-2" style="margin-top:10px">
      <div class="pill"><div class="label">рж╕рзВрж░рзНржпрзЛржжржпрж╝</div><div class="value time" id="sunrise">тАФ</div></div>
      <div class="pill"><div class="label">рж╕рзВрж░рзНржпрж╛рж╕рзНржд</div><div class="value time" id="sunset">тАФ</div></div>
      <div class="pill"><div class="label">ржЪржирзНржжрзНрж░рзЛржжржпрж╝</div><div class="value time" id="moonrise">тАФ</div></div>
      <div class="pill"><div class="label">ржЪржирзНржжрзНрж░рж╛рж╕рзНржд</div><div class="value time" id="moonset">тАФ</div></div>
    </div>
  </section>

  <!-- Popup Calendar trigger -->
  <section class="card trigger" id="openCal">ЁЯУЕ рж╕ржорзНржкрзВрж░рзНржг рж╣рж┐ржирзНржжрзБ ржкржЮрзНржЬрж┐ржХрж╛ ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░ ржжрзЗржЦрзБржи</section>

  <!-- ржПржХрж╛ржжрж╢рзА -->
  <section class="card eka">
    <div class="title">ЁЯМ╝ ржкрж░ржмрж░рзНрждрзА ржПржХрж╛ржжрж╢рзА</div>
    <div class="eka-name" id="ekaName">тАФ</div>
    <div class="eka-meta" id="ekaDate">тАФ</div>
    <div class="eka-meta" id="ekaLeft">тАФ ржжрж┐ржи ржмрж╛ржХрж┐</div>
    <div class="eka-meta" id="ekaParana">тАФ</div>
  </section>

  <!-- ржЖрж╕ржирзНржи ржЙрзОрж╕ржм -->
  <section class="card up">
    <div class="name" id="festName">ЁЯУг тАФ</div>
    <div class="meta" id="festDate">тАФ</div>
  </section>

  <!-- Tide тЖТ ржжрзБржЯрж┐ ржлрзБрж▓-ржЙржЗржбрже ржХрж╛рж░рзНржб -->
  <section class="tideBlock">
    <div class="tbTitle">ЁЯМК ржЖржЬржХрзЗрж░ ржЬрзЛржпрж╝рж╛рж░</div>
    <div class="tideGrid">
      <div class="tCell"><div class="tLab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзз</div><div class="tVal time" id="tj1">тАФ</div></div>
      <div class="tCell"><div class="tLab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзи</div><div class="tVal time" id="tj2">тАФ</div></div>
    </div>
    <div class="kolkata">ЁЯХТ ржХрж▓ржХрж╛рждрж╛</div>
    <div class="kTime" id="kTimeJ">тАФ</div>
  </section>

  <section class="tideBlock">
    <div class="tbTitle">ЁЯМК ржЖржЬржХрзЗрж░ ржнрж╛ржЯрж╛</div>
    <div class="tideGrid">
      <div class="tCell"><div class="tLab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзз</div><div class="tVal time" id="tv1">тАФ</div></div>
      <div class="tCell"><div class="tLab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзи</div><div class="tVal time" id="tv2">тАФ</div></div>
    </div>
    <div class="kolkata">ЁЯХТ ржХрж▓ржХрж╛рждрж╛</div>
    <div class="kTime" id="kTimeV">тАФ</div>
  </section>

</div>

<!-- Popup Calendar Modal -->
<div class="modal" id="calModal">
  <div class="box">
    <div class="head">
      <div>ЁЯУЕ рж╕ржорзНржкрзВрж░рзНржг ржкржЮрзНржЬрж┐ржХрж╛ ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░</div>
      <div class="close" id="closeCal">тЬЦ</div>
    </div>
    <div class="body" id="calBody">
      <!-- ржПржЦрж╛ржирзЗ ржкрж░рзЗ full calendar embed/engine ржмрж╕ржмрзЗ -->
      <p>ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░ ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░тАФржПржЦрж╛ржирзЗ рж╕ржорзНржкрзВрж░рзНржг ржкржк-ржЖржк ржкржЮрзНржЬрж┐ржХрж╛ рж░рзЗржирзНржбрж╛рж░ рж╣ржмрзЗред</p>
    </div>
  </div>
</div>

<script>
function stylizeTime(el, raw){
  if(!raw){ el.textContent='тАФ'; return; }
  const parts=raw.trim().split(/\s+/); const ampm=parts.pop(); const hhmm=parts.join(' ');
  el.innerHTML = `${hhmm} <span class="ampm">${ampm}</span>`;
}
function bnDigits(s){return String(s).replace(/\d/g,d=>"рзжрззрзирзйрзкрзлрзмрзнрзорзп"[d]);}
function liveClock(){
  const now=new Date(); let h=now.getHours(), m=now.getMinutes(), s=now.getSeconds();
  const ampm = h>=12 ? "PM":"AM"; h=((h+11)%12)+1;
  const pad=x=>String(x).padStart(2,"0");
  return `${bnDigits(pad(h))}:${bnDigits(pad(m))}:${bnDigits(pad(s))} <span class="ampm">${ampm}</span>`;
}

(async()=>{
  try{
    const j = await fetch('/api/panchika').then(r=>r.json());
    // Panchika
    document.getElementById('tithi').textContent = j.tithi?.name_bn || 'тАФ';
    document.getElementById('tithiEnds').textContent = j.tithi?.ends_at || 'тАФ';
    document.getElementById('tithiNext').textContent = j.tithi?.next_bn || 'тАФ';
    document.getElementById('paksha').textContent = j.paksha || 'тАФ';
    document.getElementById('nakshatra').textContent = j.nakshatra?.name_bn || 'тАФ';
    document.getElementById('nEnd').textContent = j.nakshatra?.ends_at || 'тАФ';
    document.getElementById('nNext').textContent = j.nakshatra?.next_bn || 'тАФ';

    // Times
    ['sunrise','sunset','moonrise','moonset'].forEach(id=>{
      const el=document.getElementById(id);
      stylizeTime(el, j[id]);
    });

    // Ekadashi
    document.getElementById('ekaName').textContent = j.ekadashi?.name_bn || 'тАФ';
    document.getElementById('ekaDate').textContent = j.ekadashi?.date || 'тАФ';
    document.getElementById('ekaLeft').textContent = (j.ekadashi?.days_left ?? 'тАФ') + ' ржжрж┐ржи ржмрж╛ржХрж┐';
    document.getElementById('ekaParana').textContent = j.ekadashi?.parana_note || '';

    // Upcoming
    document.getElementById('festName').textContent = 'ЁЯУг ' + (j.upcoming?.title || 'тАФ');
    document.getElementById('festDate').textContent = (j.upcoming?.date || 'тАФ') + ' тАв ' + (j.upcoming?.days_left ?? 'тАФ') + ' ржжрж┐ржи ржкрж░рзЗ';

    // Tide
    stylizeTime(document.getElementById('tj1'), j.tide?.high?.[0]);
    stylizeTime(document.getElementById('tj2'), j.tide?.high?.[1]);
    stylizeTime(document.getElementById('tv1'), j.tide?.low?.[0]);
    stylizeTime(document.getElementById('tv2'), j.tide?.low?.[1]);

    // Live Kolkata time on both tide cards
    const tick=()=> {
      const t = liveClock();
      document.getElementById('kTimeJ').innerHTML = t;
      document.getElementById('kTimeV').innerHTML = t;
    };
    tick(); setInterval(tick,1000);

  }catch(e){ console.error(e); }
})();

// Popup calendar modal
const modal = document.getElementById('calModal');
document.getElementById('openCal').addEventListener('click',()=>{ modal.style.display='flex'; });
document.getElementById('closeCal').addEventListener('click',()=>{ modal.style.display='none'; });
modal.addEventListener('click',e=>{ if(e.target===modal) modal.style.display='none'; });
</script>
</body>
</html>
